<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BuzzMusic Player</title>
<style>
  :root{--bg:#141414;--panel:#171717;--muted:#cbd5e1;--accent:#1db954;--border:rgba(255,255,255,.12)}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:920px;margin:32px auto 140px;padding:0 16px}
  h1{margin:0 0 10px;color:var(--accent);font-size:1.9rem}
  .muted{color:#bdbdbd}
  .banner{display:none;margin:10px 0;padding:10px;border-radius:10px}
  .warn{background:#3b1d1d;border:1px solid #7f1d1d;color:#fca5a5}
  .ok{background:#17351f;border:1px solid #166534;color:#86efac}
  .panel{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:12px;margin:12px 0}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media(max-width:900px){.grid{grid-template-columns:1fr}}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  input[type=text]{flex:1;min-width:240px;padding:10px;border-radius:8px;border:1px solid var(--border);background:#1f1f1f;color:#fff}
  button{background:var(--accent);color:#000;border:none;border-radius:8px;padding:10px 12px;font-weight:800;cursor:pointer}
  button.secondary{background:#2b2b2b;color:#fff;border:1px solid var(--border)}
  .list{display:flex;flex-direction:column;gap:8px;margin-top:8px}
  .track{display:flex;justify-content:space-between;gap:8px;padding:10px;border:1px solid var(--border);border-radius:10px;background:#1b1b1b;cursor:pointer}
  .title{font-weight:800}
  .time{color:#cbd5e1}
  audio{width:100%}
  .controls{display:flex;align-items:center;gap:8px;margin-top:8px}
  .timepair{min-width:80px;text-align:center;color:#cbd5e1}
  input[type=range]{-webkit-appearance:none;appearance:none;width:100%;height:4px;border-radius:999px;background:#2a2a2a}
  input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;border-radius:50%;background:#1db954;border:none}
  a.btn{display:inline-block;background:#2b2b2b;color:#fff;border:1px solid var(--border);border-radius:8px;padding:10px 12px;text-decoration:none}
</style>
</head>
<body>
<div class="wrap">
  <h1>BuzzMusic Player</h1>
  <p class="muted">Streams from <code>http://97.119.213.15:3001/stream/&lt;file&gt;</code>. If this page is on <b>HTTPS</b>, the browser will block HTTP audio (mixed content). See banner below.</p>

  <div id="ok"   class="banner ok">✅ Same-scheme OK. This page is <span id="pgScheme"></span> and the stream is <span id="stScheme"></span>. Playback should work.</div>
  <div id="warn" class="banner warn">⚠️ Mixed content: This page is <span id="pgScheme2"></span> but your stream is <span id="stScheme2"></span>. Browsers block this. Either host this page over HTTP on the same server, or put an HTTPS proxy/tunnel in front of your stream and point the player to that HTTPS URL.</div>

  <div class="grid">
    <div class="panel">
      <h3>Playlist</h3>
      <div class="row">
        <input id="base" type="text" placeholder="Stream base" />
        <button id="add" class="secondary">Add track</button>
        <a id="openBase" class="btn" target="_blank" rel="noreferrer">Open base</a>
      </div>
      <div class="list" id="list"></div>
    </div>
    <div class="panel">
      <h3>Player</h3>
      <div class="row">
        <button id="prev" class="secondary">⏮</button>
        <button id="toggle">▶</button>
        <button id="next" class="secondary">⏭</button>
        <span id="now" class="muted" style="flex:1;min-width:120px">Nothing playing</span>
        <a id="openTrack" class="btn" target="_blank" rel="noreferrer">Open URL</a>
      </div>
      <audio id="audio" controls crossorigin="anonymous"></audio>
      <div class="controls">
        <span id="tcur" class="timepair">0:00</span>
        <input id="seek" type="range" min="0" max="1000" value="0"/>
        <span id="tdur" class="timepair">0:00</span>
      </div>
      <div class="controls">
        <span class="muted">Volume</span>
        <input id="vol" type="range" min="0" max="1" step="0.01" value="0.9" style="width:160px"/>
      </div>
    </div>
  </div>

  <div class="panel">
    <h3>Quick Tips</h3>
    <ul class="muted">
      <li>Make sure the file really exists at <code>/stream/&lt;filename&gt;</code> (matching case). Try opening it directly.</li>
      <li>For smooth seeking, your server should support byte ranges: responses to ranged requests return <code>206</code> with <code>Accept-Ranges: bytes</code> and a valid <code>Content-Range</code>.</li>
      <li>Hosting this page on <b>HTTPS</b> while the stream is <b>HTTP</b> will be blocked. Fix by serving this page on HTTP (same box), or by putting an HTTPS reverse proxy (Cloudflare Worker/Tunnel, Caddy, nginx) in front of your stream and using that HTTPS URL as your base.</li>
    </ul>
  </div>
</div>

<script>
(() => {
  // === Edit this if you want a different default ===
  const DEFAULT_BASE = "http://97.119.213.15:3001/stream/"; // must end with a slash

  const $ = s => document.querySelector(s);
  const fmt = s => { s=Math.round(s||0); const m=Math.floor(s/60), x=String(s%60).padStart(2,'0'); return m+':'+x; };

  // Elements
  const baseIn = $('#base');
  const addBtn = $('#add');
  const listEl = $('#list');
  const audio  = $('#audio');
  const nowEl  = $('#now');
  const openBase = $('#openBase');
  const openTrack= $('#openTrack');
  const tcur = $('#tcur'), tdur = $('#tdur'), seek = $('#seek'), vol = $('#vol');
  const btnPrev = $('#prev'), btnNext = $('#next'), btnToggle = $('#toggle');

  // Mixed-content banner
  const pgScheme = location.protocol.replace(':',''); // http or https
  const stScheme = DEFAULT_BASE.split(':')[0];        // http or https
  $('#pgScheme').textContent  = pgScheme.toUpperCase();
  $('#stScheme').textContent  = stScheme.toUpperCase();
  $('#pgScheme2').textContent = pgScheme.toUpperCase();
  $('#stScheme2').textContent = stScheme.toUpperCase();

  if (pgScheme === stScheme) { $('#ok').style.display='block'; }
  else { $('#warn').style.display='block'; }

  // State
  let tracks = [
    { title: 'CRUSH.mp3', file: 'CRUSH.mp3', duration: 224 },
  ];
  let idx = -1; // nothing selected

  // Init
  baseIn.value = DEFAULT_BASE;
  openBase.href = baseIn.value;
  renderList();

  // Handlers
  addBtn.onclick = () => {
    const name = prompt('Filename at /stream/', 'MySong.mp3');
    if (!name) return;
    tracks.push({ title: name, file: name });
    renderList();
  };

  function renderList(){
    listEl.innerHTML = '';
    tracks.forEach((t,i) => {
      const row = document.createElement('div'); row.className='track';
      row.innerHTML = `<span class="title">${t.title}</span><span class="time">${t.duration?fmt(t.duration):''}</span>`;
      row.onclick = () => playIndex(i);
      listEl.appendChild(row);
    });
  }

  function urlFor(file){
    const base = baseIn.value.trim();
    const ensure = base.endsWith('/') ? base : base + '/';
    return ensure + encodeURIComponent(file);
  }

  function playIndex(i){
    idx = i;
    const t = tracks[i];
    const u = urlFor(t.file);
    audio.src = u;
    audio.play().catch(()=>{});
    nowEl.textContent = t.title;
    openTrack.href = u;
    btnToggle.textContent = '⏸';
  }

  btnPrev.onclick = () => { if (tracks.length){ idx = (idx-1+tracks.length)%tracks.length; playIndex(idx); } };
  btnNext.onclick = () => { if (tracks.length){ idx = (idx+1)%tracks.length; playIndex(idx); } };
  btnToggle.onclick = () => {
    if (audio.paused){ audio.play().catch(()=>{}); btnToggle.textContent='⏸'; }
    else { audio.pause(); btnToggle.textContent='▶'; }
  };

  // Seek & volume
  vol.oninput = () => audio.volume = +vol.value;
  seek.oninput = () => { if (audio.duration) audio.currentTime = (seek.value/1000)*audio.duration; };
  audio.ontimeupdate = () => {
    const d=audio.duration||0, c=audio.currentTime||0;
    tcur.textContent = fmt(c); tdur.textContent = fmt(d);
    if (d) seek.value = Math.floor(1000*c/d);
  };
  audio.onended = () => btnNext.click();

  // Keyboard
  window.addEventListener('keydown', e => {
    if (['INPUT','TEXTAREA'].includes(document.activeElement.tagName)) return;
    if (e.code === 'Space'){ e.preventDefault(); btnToggle.click(); }
    if (e.code === 'ArrowRight'){ audio.currentTime = Math.min((audio.currentTime||0)+5, audio.duration||Infinity); }
    if (e.code === 'ArrowLeft'){  audio.currentTime = Math.max((audio.currentTime||0)-5, 0); }
  });

  // If you want to auto-start CRUSH on load, uncomment:
  // playIndex(0);
})();
</script>
</body>
</html>
