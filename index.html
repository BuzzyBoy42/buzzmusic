<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BuzzMusic</title>
<style>
  body{margin:0;background:#141414;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:900px;margin:32px auto 140px;padding:0 16px}
  h1{font-size:1.8rem;margin:0 0 12px;color:#1db954}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px}
  .card{background:#1b1b1b;border:1px solid rgba(255,255,255,.08);border-radius:12px;overflow:hidden;cursor:pointer}
  .card img{width:100%;aspect-ratio:1/1;object-fit:cover;background:#111}
  .card .body{padding:10px 12px}
  .muted{color:#bdbdbd}
  .tester{background:#171717;border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:12px;margin-top:20px}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
  input[type=text]{flex:1;min-width:200px;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.12);background:#1f1f1f;color:#fff}
  button{background:#1db954;color:#000;border:none;border-radius:8px;padding:10px 12px;font-weight:700;cursor:pointer}
  pre{background:#0f0f0f;border:1px solid rgba(255,255,255,.12);padding:8px;border-radius:8px;white-space:pre-wrap}
  .player{position:fixed;left:0;right:0;bottom:0;background:#0d0d0d;border-top:1px solid rgba(255,255,255,.1);display:grid;grid-template-columns:1fr 460px 1fr;gap:8px;align-items:center;padding:8px 12px}
  .controls{display:flex;flex-direction:column;align-items:center;gap:6px}
  .btns{display:flex;gap:8px}
  .btn{width:36px;height:36px;border-radius:999px;display:grid;place-items:center;background:#1f1f1f;border:1px solid rgba(255,255,255,.1);color:#fff;cursor:pointer}
  .btn.primary{background:#1db954;color:#000;font-weight:900;width:42px;height:42px}
  input[type=range]{-webkit-appearance:none;appearance:none;width:100%;height:4px;border-radius:999px;background:#2a2a2a}
  input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;border-radius:50%;background:#1db954;border:none}
  .right{display:flex;justify-content:flex-end;gap:10px}
</style>
</head>
<body>
<div class="wrap">
  <h1>BuzzMusic</h1>
  <p class="muted">Streaming via HTTPS proxy ‚Üí <code>97.119.213.15:3001</code></p>

  <h2>Featured</h2>
  <div class="grid" id="grid"></div>

  <div class="tester">
    <h3>üß™ Stream Tester</h3>
    <div class="row">
      <input id="file" type="text" placeholder="Filename (e.g., CRUSH.mp3)" />
      <button id="run">Run Tests</button>
      <button id="play">Play</button>
      <a id="open" target="_blank" style="display:inline-block;background:#2b2b2b;color:#fff;padding:10px 12px;border-radius:8px;text-decoration:none">Open URL</a>
    </div>
    <pre id="out">Enter a filename and click Run Tests</pre>
    <audio id="diagAudio" controls style="width:100%"></audio>
  </div>
</div>

<div class="player">
  <div></div>
  <div class="controls">
    <div class="btns">
      <button id="prev" class="btn">‚èÆ</button>
      <button id="toggle" class="btn primary">‚ñ∂</button>
      <button id="next" class="btn">‚è≠</button>
    </div>
    <div style="display:flex;align-items:center;gap:8px;width:100%">
      <span id="tcur" style="width:40px;text-align:center">0:00</span>
      <input id="seek" type="range" min="0" max="1000" value="0">
      <span id="tdur" style="width:40px;text-align:center">0:00</span>
    </div>
  </div>
  <div class="right">
    <input id="vol" type="range" min="0" max="1" step="0.01" value="0.9" style="width:140px">
  </div>
  <audio id="audio"></audio>
</div>

<script>
(() => {
  // CHANGE THIS to your Worker HTTPS base:
  // e.g. "https://your-subdomain.workers.dev/stream/"
  const PROXY_BASE = "https://YOUR-WORKER-SUBDOMAIN.workers.dev/stream/";

  // Demo tracks (files must exist on your origin at /stream/<file>)
  const tracks = [
    {id:'t1', title:'CRUSH', artist:'Luxe City', cover:'https://images.unsplash.com/photo-1531746790731-6c087fecd65a?q=80&w=1200&auto=format&fit=crop', file:'CRUSH.mp3', duration:224},
    {id:'t2', title:'Another Song', artist:'Artist', cover:'https://images.unsplash.com/photo-1533105079780-92b9be482077?q=80&w=1200&auto=format&fit=crop', file:'Another.mp3', duration:180}
  ];

  // Simple UI render
  const grid = document.getElementById('grid');
  function card(t){
    const d=document.createElement('div'); d.className='card';
    d.innerHTML = \`<img src="\${t.cover}"><div class="body"><div><b>\${t.title}</b></div><div class="muted">\${t.artist}</div></div>\`;
    d.onclick=()=> playFile(t.file);
    return d;
  }
  tracks.forEach(t => grid.appendChild(card(t)));

  // Player
  const audio = document.getElementById('audio');
  const toggle = document.getElementById('toggle');
  const seek = document.getElementById('seek'), tcur=document.getElementById('tcur'), tdur=document.getElementById('tdur'), vol=document.getElementById('vol');
  vol.oninput=()=> audio.volume=+vol.value;
  toggle.onclick=()=>{ if(audio.paused){ audio.play().catch(()=>{}); toggle.textContent='‚è∏'; } else { audio.pause(); toggle.textContent='‚ñ∂'; } };
  audio.ontimeupdate=()=>{ const d=audio.duration||0,c=audio.currentTime||0; tcur.textContent=fmt(c); tdur.textContent=fmt(d); if(d) seek.value=Math.floor(1000*c/d); };
  seek.oninput=()=>{ if(audio.duration){ audio.currentTime = (seek.value/1000)*audio.duration; } };

  function fmt(s){ s=Math.round(s||0); const m=Math.floor(s/60); const x=(s%60).toString().padStart(2,'0'); return \`\${m}:\${x}\`; }
  function urlFor(file){ return PROXY_BASE + encodeURIComponent(file); }
  function playFile(file){ audio.src=urlFor(file); audio.play().catch(()=>{}); toggle.textContent='‚è∏'; }

  // Tester
  const file = document.getElementById('file');
  const run  = document.getElementById('run');
  const play = document.getElementById('play');
  const open = document.getElementById('open');
  const out  = document.getElementById('out');
  const diag = document.getElementById('diagAudio');

  function resolve(){ const f=(file.value||'CRUSH.mp3').trim(); const u=urlFor(f); open.href=u; return u; }
  play.onclick=()=>{ const u=resolve(); diag.src=u; diag.play().catch(e=>log('‚ùå Audio play error: '+e.message)); };
  open.href = resolve();
  run.onclick=async ()=>{
    out.textContent='Running‚Ä¶';
    const u=resolve();
    try{
      try{ const h=await fetch(u,{method:'HEAD',cache:'no-store'}); log(\`HEAD ‚Üí \${h.status}\`);}catch{ log('HEAD failed (not fatal)'); }
      const r=await fetch(u,{method:'GET',headers:{Range:'bytes=0-1'},cache:'no-store'});
      log(\`GET Range 0-1 ‚Üí \${r.status}\`);
      log('Accept-Ranges: '+(r.headers.get('Accept-Ranges')||'(none)'));
      log('Content-Range: '+(r.headers.get('Content-Range')||'(none)'));
      log('Content-Type: '+(r.headers.get('Content-Type')||'(none)'));
      if(r.status===206) log('‚úÖ Byte-range OK (seeking works).');
      else if(r.status===200) log('‚ÑπÔ∏è 200 OK (seek may be limited).');
      else if(r.status===404) log('‚ùå 404 (check filename).');
      else log('‚ö†Ô∏è Unexpected status.');
    }catch(e){ log('‚ùå Fetch failed: '+e.message); }
  };
  function log(m){ out.textContent += (out.textContent? "\n": "") + m; out.scrollTop=out.scrollHeight; }

  // Start with CRUSH.mp3
  file.value = 'CRUSH.mp3';
})();
</script>
</body>
</html>
