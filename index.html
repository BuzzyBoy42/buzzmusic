<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BuzzMusic – Proxy Test Player</title>
<style>
  body{margin:0;background:#141414;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:900px;margin:40px auto 140px;padding:0 16px}
  h1{color:#1db954;margin:0 0 12px}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
  input[type=text]{flex:1;min-width:260px;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.12);background:#1f1f1f;color:#fff}
  button,a.btn{background:#1db954;color:#000;border:none;border-radius:8px;padding:10px 12px;font-weight:700;cursor:pointer;text-decoration:none}
  button.secondary{background:#2b2b2b;color:#fff;border:1px solid rgba(255,255,255,.12)}
  .panel{background:#171717;border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:12px;margin-top:16px}
  pre{background:#0f0f0f;border:1px solid rgba(255,255,255,.12);padding:8px;border-radius:8px;white-space:pre-wrap;min-height:110px}
  audio{width:100%}
  .muted{color:#bdbdbd}
</style>
</head>
<body>
<div class="wrap">
  <h1>BuzzMusic – Proxy Test Player</h1>
  <p class="muted">Streams through your Cloudflare Worker (HTTPS) → your home server (HTTP).</p>

  <div class="row">
    <input id="file" type="text" placeholder="Filename (e.g., CRUSH.mp3)"/>
    <button id="play">Play</button>
    <button id="check" class="secondary">Run Range Check</button>
    <a id="open" class="btn" target="_blank" rel="noreferrer">Open Direct</a>
  </div>

  <div class="panel">
    <audio id="audio" controls crossorigin="anonymous"></audio>
  </div>

  <div class="panel">
    <h3>Diagnostics</h3>
    <pre id="out">Enter a filename and click “Run Range Check”.</pre>
  </div>
</div>

<script>
(() => {
  // >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
  // CHANGE THIS to your Worker base (MUST end with /audio/):
  const PROXY_BASE = "https://YOUR-WORKER-SUBDOMAIN.workers.dev/audio/";
  // <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

  const $ = s => document.querySelector(s);
  const file = $('#file'), audio = $('#audio'), out = $('#out'), open = $('#open');

  file.value = 'CRUSH.mp3'; // default demo name

  function urlFor(name){ return PROXY_BASE + encodeURIComponent(name.trim()); }
  function log(m){ out.textContent += (out.textContent ? "\n" : "") + m; out.scrollTop = out.scrollHeight; }

  $('#play').onclick = () => {
    const u = urlFor(file.value || 'CRUSH.mp3');
    open.href = u;
    audio.src = u;
    audio.play().catch(e => log('play() blocked: ' + e.message));
  };

  $('#check').onclick = async () => {
    out.textContent = 'Running range check…';
    const u = urlFor(file.value || 'CRUSH.mp3');
    open.href = u;
    try {
      // HEAD (some origins may not support; not fatal)
      try { const h = await fetch(u, { method:'HEAD', cache:'no-store' }); log('HEAD → ' + h.status); } catch { log('HEAD failed (not fatal)'); }
      const r = await fetch(u, { method:'GET', headers:{ Range:'bytes=0-1' }, cache:'no-store' });
      log('GET Range 0-1 → ' + r.status);
      log('Accept-Ranges: ' + (r.headers.get('Accept-Ranges') || '(none)'));
      log('Content-Range: ' + (r.headers.get('Content-Range') || '(none)'));
      log('Content-Type:  ' + (r.headers.get('Content-Type')  || '(none)'));
      if (r.status === 206) log('✅ Byte-range OK (seeking works).');
      else if (r.status === 200) log('ℹ️ 200 OK (server didn’t honor Range; seek may be limited).');
      else if (r.status === 404) log('❌ 404 Not Found — check filename at origin: /stream/<file>');
      else log('⚠️ Unexpected status.');
    } catch (e) {
      log('❌ Fetch failed: ' + e.message);
    }
  };
})();
</script>
</body>
</html>
