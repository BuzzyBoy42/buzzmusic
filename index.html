<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>BuzzMusic ‚Äî Google Drive Stream</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{--bg:#141414;--card:#1b1b1b;--soft:#232323;--text:#fff;--brand:#1db954;--border:rgba(255,255,255,.08)}
    body{background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{max-width:980px;margin:32px auto 120px;padding:0 16px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .logo{font-weight:900;font-size:1.6rem;letter-spacing:.3px;color:var(--brand)}
    .search{display:flex;justify-content:center;margin:12px 0 18px}
    .search input{width:min(640px,92%);padding:.8rem 1rem;border-radius:999px;background:#1e1e1e;color:#fff;border:1px solid var(--border);outline:none}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden}
    .card img{width:100%;aspect-ratio:1/1;object-fit:cover;background:#111}
    .card-body{padding:.75rem 0.85rem 1rem}
    .title{font-weight:800;margin-bottom:4px}
    .sub{color:#cfcfcf;font-size:.92rem}
    .btns{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
    .btn{background:var(--brand);color:#000;border:none;border-radius:999px;padding:.55rem .9rem;font-weight:800;cursor:pointer}
    .btn.secondary{background:#2b2b2b;color:#fff;border:1px solid var(--border)}
    .player{position:fixed;left:0;right:0;bottom:0;background:#0d0d0d;border-top:1px solid var(--border);padding:.6rem .8rem;display:grid;grid-template-columns:320px 1fr 320px;gap:10px;align-items:center;z-index:10}
    .now{display:flex;align-items:center;gap:.7rem;min-width:0}
    .now img{width:56px;height:56px;border-radius:6px;object-fit:cover}
    .now .t{font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .now .a{color:#d0d0d0;font-size:.9rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .controls{display:flex;flex-direction:column;align-items:center;gap:.45rem}
    .buttons{display:flex;align-items:center;gap:.5rem}
    .iconbtn{background:#1f1f1f;border:1px solid var(--border);color:#fff;width:34px;height:34px;border-radius:999px;display:grid;place-items:center;cursor:pointer}
    .iconbtn.primary{background:var(--brand);color:#000;font-weight:900;width:40px;height:40px}
    .progress{width:min(680px,92vw);display:flex;align-items:center;gap:8px}
    .time{font-size:.75rem;color:#c6c6c6;width:36px;text-align:center}
    input[type=range]{-webkit-appearance:none;appearance:none;width:100%;height:4px;border-radius:999px;background:#2a2a2a;outline:none}
    input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;border-radius:50%;background:var(--brand);border:none}
    .right{display:flex;align-items:center;justify-content:flex-end;gap:.6rem}
    .pill{padding:.25rem .6rem;border-radius:999px;border:1px solid var(--border);background:#1a1a1a;font-size:.8rem}
    @media(max-width:900px){.player{grid-template-columns:1fr;gap:.6rem}.right{justify-content:center}}
    .note{margin-top:20px;color:#cfcfcf;font-size:.9rem;line-height:1.5}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">BuzzMusic</div>
    </header>

    <div class="search"><input id="q" placeholder="Search songs‚Ä¶"></div>

    <div id="list" class="grid"></div>

    <p class="note">
      Tip: Ensure your Google Drive file is shared as <b>Anyone with the link ‚Üí Viewer</b>.  
      This page streams directly from <code>drive.google.com</code> over HTTPS. If playback fails
      (quota/scan page), use ‚ÄúOpen Direct‚Äù to play in a new tab.
    </p>
  </div>

  <!-- Player -->
  <div class="player">
    <div class="now">
      <img id="nowCover" alt="cover" src="https://images.unsplash.com/photo-1531746790731-6c087fecd65a?q=80&w=600&auto=format&fit=crop"/>
      <div style="min-width:0">
        <div class="t" id="nowTitle">Nothing playing</div>
        <div class="a" id="nowArtist"></div>
      </div>
    </div>
    <div class="controls">
      <div class="buttons">
        <button class="iconbtn" id="prev">‚èÆ</button>
        <button class="iconbtn primary" id="play">‚ñ∂</button>
        <button class="iconbtn" id="next">‚è≠</button>
      </div>
      <div class="progress">
        <span class="time" id="tCur">0:00</span>
        <input type="range" id="seek" min="0" max="1000" value="0"/>
        <span class="time" id="tDur">0:00</span>
      </div>
    </div>
    <div class="right">
      <span class="pill" id="qCount">Queue: 0</span>
      <input type="range" id="vol" min="0" max="1" step="0.01" value="0.9" style="width:140px"/>
    </div>
    <audio id="audio" preload="none"></audio>
  </div>

  <script>
    // --- Google Drive helpers ---
    const gdriveDirect = (id) => `https://drive.google.com/uc?export=download&id=${id}`;

    // Your shared file ID from the link you gave:
    const FILE_ID_FROM_YOU = "138HzI1mM47HkSd0jh2_FOSqiX6lCLaCx";

    // Demo tracks (first one uses your Google Drive file)
    const tracks = [
      {
        id: 'gd1',
        title: 'Your Google Drive Track',
        artist: 'BuzzMusic',
        album: 'Drive Demo',
        cover: 'https://images.unsplash.com/photo-1531746790731-6c087fecd65a?q=80&w=1200&auto=format&fit=crop',
        gdriveId: FILE_ID_FROM_YOU
      },
      {
        id: 'gd2',
        title: 'Another Drive Track (change the ID)',
        artist: 'BuzzMusic',
        album: 'Drive Demo',
        cover: 'https://images.unsplash.com/photo-1533105079780-92b9be482077?q=80&w=1200&auto=format&fit=crop',
        gdriveId: FILE_ID_FROM_YOU // duplicate for demo; replace with another file id if you have one
      }
    ];

    const $ = s => document.querySelector(s);
    const list = $('#list'); const q = $('#q');
    const audio = $('#audio'); const nowCover=$('#nowCover'); const nowTitle=$('#nowTitle'); const nowArtist=$('#nowArtist');
    const btnPlay=$('#play'), btnPrev=$('#prev'), btnNext=$('#next');
    const seek=$('#seek'), vol=$('#vol'); const tCur=$('#tCur'), tDur=$('#tDur'); const qCount=$('#qCount');

    const state = { queue: [], current: null };

    function fmtTime(sec){ sec=Math.round(sec||0); const m=Math.floor(sec/60); const s=(sec%60).toString().padStart(2,'0'); return `${m}:${s}`; }

    function srcFor(t){
      if (t.gdriveId) return gdriveDirect(t.gdriveId);
      return t.src || '';
    }

    function render(filter=''){
      list.innerHTML='';
      tracks
        .filter(t => !filter || (`${t.title} ${t.artist} ${t.album}`).toLowerCase().includes(filter))
        .forEach(t => {
          const card = document.createElement('div'); card.className='card';
          card.innerHTML = `
            <img src="${t.cover}" alt="${t.title} cover"/>
            <div class="card-body">
              <div class="title">${t.title}</div>
              <div class="sub">${t.artist} ‚Ä¢ ${t.album}</div>
              <div class="btns">
                <button class="btn" data-id="${t.id}">‚ñ∂ Play</button>
                <button class="btn secondary" data-open="${t.id}">üîó Open Direct</button>
              </div>
            </div>`;
          card.querySelector('[data-id]').onclick = () => playById(t.id);
          card.querySelector('[data-open]').onclick = () => openDirect(t.id);
          list.appendChild(card);
        });
    }

    function playById(id){
      const t = tracks.find(x => x.id === id); if(!t) return;
      const url = srcFor(t);
      // update UI
      nowCover.src = t.cover; nowTitle.textContent = t.title; nowArtist.textContent = `${t.artist} ‚Ä¢ ${t.album}`;
      if (!state.queue.includes(id)) state.queue.push(id);
      state.current = id; qCount.textContent = `Queue: ${state.queue.length}`;

      audio.src = url;
      audio.play().then(() => {
        btnPlay.textContent = '‚è∏';
      }).catch(err => {
        // If Drive serves an interstitial (quota/scan), inline playback can fail. Offer direct open.
        console.warn('Inline play failed:', err);
        if (confirm('Inline playback failed. Open the file in a new tab?')) {
          openDirect(id);
        }
      });
    }

    function openDirect(id){
      const t = tracks.find(x => x.id === id); if(!t) return;
      window.open(srcFor(t), '_blank', 'noopener,noreferrer');
    }

    // transport controls
    btnPlay.onclick = () => { if(audio.paused){ audio.play().catch(()=>{}); btnPlay.textContent='‚è∏'; } else { audio.pause(); btnPlay.textContent='‚ñ∂'; } };
    btnPrev.onclick = () => step(-1);
    btnNext.onclick = () => step(1);
    function step(dir){
      if(!state.queue.length) return;
      const i = state.queue.indexOf(state.current);
      const n = (i + dir + state.queue.length) % state.queue.length;
      playById(state.queue[n]);
    }

    // progress & volume
    vol.addEventListener('input', () => audio.volume = +vol.value);
    seek.addEventListener('input', () => { if(audio.duration){ const p=seek.value/1000; audio.currentTime=p*audio.duration; }});
    audio.addEventListener('timeupdate', () => {
      const d=audio.duration||0, c=audio.currentTime||0;
      tCur.textContent = fmtTime(c); tDur.textContent = fmtTime(d);
      if(d) seek.value = Math.floor((c/d)*1000);
    });
    audio.addEventListener('ended', () => step(1));

    // search
    q.addEventListener('input', e => render(e.target.value.trim().toLowerCase()));

    // init
    render();
  </script>
</body>
</html>
